# Look Alike

ä¸€ä¸ªé«˜æ€§èƒ½çš„å›¾ç‰‡ç›¸ä¼¼åº¦æ¯”å¯¹å·¥å…·ï¼Œç”¨äºæŸ¥æ‰¾å’ŒåŒ¹é…ç›¸ä¼¼çš„å›¾ç‰‡ã€‚

## é¡¹ç›®ç»“æ„

```
look-alike/
â”œâ”€â”€ client/         # å‰ç«¯é¡¹ç›® (React + Vite)
â”œâ”€â”€ go-server/      # åç«¯æœåŠ¡ (Golang) âœ¨ NEW!
â”œâ”€â”€ backup-ruby/    # Rubyç‰ˆæœ¬å¤‡ä»½ (å·²è¿ç§»)
â”œâ”€â”€ Makefile        # Make å‘½ä»¤
â””â”€â”€ README.md
```

## æŠ€æœ¯æ ˆ

### å‰ç«¯
- React 19
- TypeScript
- Vite
- Ant Design
- React Router

### åç«¯ (Golang)
- **è¯­è¨€**: Go 1.21+
- **Webæ¡†æ¶**: Gin
- **ORM**: GORM
- **æ•°æ®åº“**: SQLite3
- **å›¾ç‰‡å¤„ç†**: imaging (çº¯Goå®ç°)
- **å¹¶å‘**: Goroutines + Channels

## å¿«é€Ÿå¯åŠ¨

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Makefileï¼ˆæ¨èï¼‰

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# å®‰è£…æ‰€æœ‰ä¾èµ–
make install

# å¼€å‘æ¨¡å¼ï¼ˆå‰ç«¯+åç«¯åŒæ—¶å¯åŠ¨ï¼‰
make start-dev

# ç”Ÿäº§æ¨¡å¼ï¼ˆç¼–è¯‘åç«¯å¹¶å¯åŠ¨ï¼‰
make start-prod
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

#### 1. å®‰è£…ä¾èµ–

**Go åç«¯ä¾èµ–ï¼š**
```bash
cd go-server
GOPROXY=https://goproxy.cn,direct go mod download
```

**å‰ç«¯ä¾èµ–ï¼š**
```bash
cd client
npm install
```

#### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**åç«¯ï¼ˆç«¯å£ 4568ï¼‰ï¼š**
```bash
cd go-server
go run ./cmd/server
```

**å‰ç«¯ï¼ˆç«¯å£ 5174ï¼‰ï¼š**
```bash
cd client
npm run dev
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://localhost:5174

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶

```bash
make build
```

è¿™ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ `look-alike-server` å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆçº¦33MBï¼‰ã€‚

### æ„å»ºå‰ç«¯

```bash
make build-client
```

### è¿è¡Œ

```bash
# æ–¹å¼1: ä½¿ç”¨ Makefile
make start-prod

# æ–¹å¼2: ç›´æ¥è¿è¡Œ
./look-alike-server
```

æœåŠ¡å™¨ä¼šè‡ªåŠ¨ï¼š
- å¯åŠ¨APIæœåŠ¡ (ç«¯å£ 4568)
- æä¾›å‰ç«¯é™æ€æ–‡ä»¶
- è®¿é—® http://localhost:4568

## ä¸»è¦åŠŸèƒ½

### 1. å›¾ç‰‡ç›¸ä¼¼åº¦ç®—æ³•

é‡‡ç”¨4ç§å“ˆå¸Œç®—æ³•ç»„åˆï¼ŒåŠ æƒè®¡ç®—ç›¸ä¼¼åº¦ï¼š

| ç®—æ³• | æƒé‡ | ç‰¹ç‚¹ |
|------|------|------|
| pHash (æ„ŸçŸ¥å“ˆå¸Œ) | 40% | åŸºäºDCTå˜æ¢ï¼Œå¯¹ç¼©æ”¾å‹ç¼©ä¸æ•æ„Ÿ |
| aHash (å¹³å‡å“ˆå¸Œ) | 20% | åŸºäºå¹³å‡ç°åº¦ï¼Œç®€å•å¿«é€Ÿ |
| dHash (å·®åˆ†å“ˆå¸Œ) | 20% | åŸºäºåƒç´ å·®å¼‚ï¼Œå¯¹æ°´å¹³å˜åŒ–æ•æ„Ÿ |
| ç›´æ–¹å›¾æ¯”è¾ƒ | 20% | ä½¿ç”¨å·´æ°ç³»æ•°ï¼Œå¯¹é¢œè‰²åˆ†å¸ƒæ•æ„Ÿ |

### 2. é«˜æ€§èƒ½å¹¶å‘å¤„ç†

- ä½¿ç”¨ Go åŸç”Ÿ goroutines è¿›è¡Œå¹¶å‘å¤„ç†
- Semaphore æ¨¡å¼æ§åˆ¶å¹¶å‘æ•°ï¼ˆé»˜è®¤4ä¸ªï¼‰
- æ‰¹é‡æ•°æ®åº“æ“ä½œï¼ˆæ¯æ‰¹100æ¡ï¼‰
- è‡ªé€‚åº”å°ºå¯¸è¿‡æ»¤ï¼Œå‡å°‘æ¯”è¾ƒæ¬¡æ•°

### 3. æ™ºèƒ½åŒ¹é…

- è‡ªé€‚åº”é˜ˆå€¼ç®—æ³•
- æ¸è¿›å¼å®¹å·®ç­›é€‰
- å¼ºåˆ¶ä¿è¯æ¯ä¸ªæºæ–‡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªåŒ¹é…

### 4. ç”¨æˆ·å‹å¥½ç•Œé¢

- æ–‡ä»¶æ ‘å±•ç¤º
- å€™é€‰é¡¹é¢„è§ˆ
- æ‰¹é‡æ“ä½œ
- è¿›åº¦è¿½è¸ª

## API ç«¯ç‚¹

å®Œæ•´å®ç° 15 ä¸ª REST API ç«¯ç‚¹ï¼š

```
GET    /api/health                          # å¥åº·æ£€æŸ¥
GET    /api/projects                        # é¡¹ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
POST   /api/projects                        # åˆ›å»ºé¡¹ç›®
GET    /api/projects/:id                    # é¡¹ç›®è¯¦æƒ…
DELETE /api/projects/:id                    # åˆ é™¤é¡¹ç›®
GET    /api/projects/:id/files              # æ–‡ä»¶æ ‘ç»“æ„
POST   /api/projects/:id/candidates         # è·å–å€™é€‰é¡¹
GET    /api/image                           # å›¾ç‰‡æœåŠ¡
POST   /api/projects/:id/select_candidate   # é€‰æ‹©å€™é€‰é¡¹
POST   /api/projects/:id/mark_no_match      # æ ‡è®°æ— åŒ¹é…
POST   /api/projects/:id/confirm_row        # ç¡®è®¤è¡Œ
POST   /api/projects/:id/export             # å¯¼å‡º
GET    /api/projects/:id/export_progress    # å¯¼å‡ºè¿›åº¦
```

## Makefile å‘½ä»¤

```bash
make help          # æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
make build         # ç¼–è¯‘æœåŠ¡å™¨
make run           # ç¼–è¯‘å¹¶è¿è¡Œ
make dev           # å¼€å‘æ¨¡å¼è¿è¡Œï¼ˆæ— éœ€ç¼–è¯‘ï¼‰
make install       # å®‰è£…æ‰€æœ‰ä¾èµ–
make build-client  # æ„å»ºå‰ç«¯
make start-dev     # å¼€å‘æ¨¡å¼ï¼ˆå‰ç«¯+åç«¯ï¼‰
make start-prod    # ç”Ÿäº§æ¨¡å¼
make clean         # æ¸…ç†æ„å»ºæ–‡ä»¶
make test          # è¿è¡Œæµ‹è¯•
make fmt           # æ ¼å¼åŒ–ä»£ç 
make lint          # ä»£ç æ£€æŸ¥
```

## æ€§èƒ½ä¼˜åŠ¿

ç›¸æ¯” Ruby ç‰ˆæœ¬çš„æ”¹è¿›ï¼š

| æŒ‡æ ‡ | Ruby ç‰ˆæœ¬ | Go ç‰ˆæœ¬ | æå‡ |
|------|----------|---------|------|
| å¤„ç†é€Ÿåº¦ | åŸºå‡† | 2-5x | â¬†ï¸ |
| å†…å­˜å ç”¨ | åŸºå‡† | 0.5-0.7x | â¬‡ï¸ |
| å¹¶å‘èƒ½åŠ› | Thread | Goroutine | â¬†ï¸â¬†ï¸ |
| éƒ¨ç½²å¤æ‚åº¦ | éœ€è¦Rubyç¯å¢ƒ | å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶ | â¬‡ï¸â¬‡ï¸ |
| å¯åŠ¨é€Ÿåº¦ | ~2s | ~0.1s | â¬†ï¸â¬†ï¸ |

## ç¯å¢ƒè¦æ±‚

- **Go**: 1.21+ ï¼ˆå¼€å‘/ç¼–è¯‘æ—¶éœ€è¦ï¼‰
- **Node.js**: 16+ ï¼ˆå¼€å‘å‰ç«¯æ—¶éœ€è¦ï¼‰
- **æµè§ˆå™¨**: ç°ä»£æµè§ˆå™¨ï¼ˆChrome, Firefox, Safari, Edgeï¼‰

## é…ç½®

### ç¯å¢ƒå˜é‡

- `PORT`: æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤: 4568ï¼‰
- `GOPROXY`: Go æ¨¡å—ä»£ç†ï¼ˆæ¨è: https://goproxy.cn,directï¼‰

### æ•°æ®åº“

- ç±»å‹: SQLite3
- ä½ç½®: `db/look_alike.sqlite3`
- æ¨¡å¼: WAL (Write-Ahead Logging)
- å…¼å®¹åŸ Ruby ç‰ˆæœ¬çš„ schema

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•ä» Ruby ç‰ˆæœ¬è¿ç§»ï¼Ÿ

A: Go ç‰ˆæœ¬å®Œå…¨å…¼å®¹ Ruby ç‰ˆæœ¬çš„æ•°æ®åº“ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚Ruby ä»£ç å·²å¤‡ä»½è‡³ `backup-ruby/` ç›®å½•ã€‚

### Q: ç¼–è¯‘æ—¶é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Ÿ

A: è®¾ç½®å›½å†… Go ä»£ç†ï¼š
```bash
export GOPROXY=https://goproxy.cn,direct
```

### Q: å‰ç«¯æç¤º "Frontend assets not found"ï¼Ÿ

A: å…ˆæ„å»ºå‰ç«¯ï¼š
```bash
cd client && npm run build
```

### Q: æ•°æ®åº“é”å®šé”™è¯¯ï¼Ÿ

A: ç¡®ä¿åªæœ‰ä¸€ä¸ªæœåŠ¡å®ä¾‹åœ¨è¿è¡Œã€‚SQLite WAL æ¨¡å¼å·²å¯ç”¨ä»¥æé«˜å¹¶å‘æ€§èƒ½ã€‚

### Q: æ”¯æŒå“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ

A: æ”¯æŒ JPEG, PNG, GIF, TIFF, BMP, WebPã€‚

## é¡¹ç›®è¿ç§»è¯´æ˜

æœ¬é¡¹ç›®å·²ä» Ruby (Sinatra + RMagick) å®Œå…¨è¿ç§»åˆ° Golang (Gin + imaging)ã€‚

### ä¸»è¦å˜æ›´ï¼š

1. **åç«¯è¯­è¨€**: Ruby â†’ Golang
2. **Webæ¡†æ¶**: Sinatra â†’ Gin
3. **å›¾ç‰‡å¤„ç†**: RMagick (ImageMagick) â†’ imaging (çº¯Go)
4. **ORM**: ActiveRecord â†’ GORM
5. **å¹¶å‘æ¨¡å‹**: Thread + Mutex â†’ Goroutines + Channels
6. **éƒ¨ç½²æ–¹å¼**: éœ€è¦Rubyç¯å¢ƒ â†’ å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶

### ä¿æŒä¸å˜ï¼š

- âœ… æ•°æ®åº“ schema å®Œå…¨å…¼å®¹
- âœ… API æ¥å£ä¿æŒä¸€è‡´
- âœ… å‰ç«¯æ— éœ€ä»»ä½•ä¿®æ”¹
- âœ… ç®—æ³•ç»“æœä¿æŒä¸€è‡´ï¼ˆè¯¯å·®<5%ï¼‰

### Ruby ç‰ˆæœ¬å¤‡ä»½ï¼š

åŸ Ruby ä»£ç å·²ç§»è‡³ `backup-ruby/` ç›®å½•ï¼ŒåŒ…å«ï¼š
- `backup-ruby/server/` - Ruby åç«¯
- `backup-ruby/img-lib/` - Ruby å›¾ç‰‡å¤„ç†åº“
- `backup-ruby/Gemfile*` - Ruby ä¾èµ–

## å¼€å‘æŒ‡å—

è¯¦ç»†çš„å¼€å‘æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š

- [Go Server README](go-server/README.md)
- [å‰ç«¯ README](client/README.md)

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

MIT License

## æ›´æ–°æ—¥å¿—

### v1.0.0-go (2024-12-11)

- âœ¨ å®Œæˆ Ruby åˆ° Golang çš„å®Œæ•´è¿ç§»
- âš¡ æ€§èƒ½æå‡ 2-5å€
- ğŸ“¦ æ”¯æŒç¼–è¯‘æˆå•ä¸€å¯æ‰§è¡Œæ–‡ä»¶
- ğŸ”§ ç®€åŒ–éƒ¨ç½²æµç¨‹
- ğŸ“ å®Œå–„æ–‡æ¡£å’Œ Makefile

### v0.1.0-ruby (2023-12)

- ğŸ‰ åˆå§‹ Ruby ç‰ˆæœ¬å‘å¸ƒ
